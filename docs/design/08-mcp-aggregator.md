# MCPã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚¿ãƒ¼è¨­è¨ˆ

## æ¦‚è¦

Search MCP Serverã‚’**MCPã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚¿ãƒ¼**ã¨ã—ã¦æ©Ÿèƒ½ã•ã›ã€è¤‡æ•°ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’æŸã­ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¶ˆè²»ã‚’å‰Šæ¸›ã—ã¾ã™ã€‚

## å•é¡Œã®å®šç¾©

### ç¾åœ¨ã®èª²é¡Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude CLI     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¥ç¶šå…ˆ:         â”‚
â”‚  - filesystem   â”‚ â†’ 50å€‹ã®ãƒ„ãƒ¼ãƒ«
â”‚  - brave-search â”‚ â†’ 20å€‹ã®ãƒ„ãƒ¼ãƒ«
â”‚  - database     â”‚ â†’ 30å€‹ã®ãƒ„ãƒ¼ãƒ«
â”‚  - slack        â”‚ â†’ 15å€‹ã®ãƒ„ãƒ¼ãƒ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
å…¨ãƒ„ãƒ¼ãƒ«ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
= 115å€‹ã®ãƒ„ãƒ¼ãƒ« Ã— å¹³å‡200ãƒˆãƒ¼ã‚¯ãƒ³ = 23,000ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»
```

**å•é¡Œç‚¹**:
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’å¤§é‡ã«æ¶ˆè²»
- å®Ÿéš›ã«ä½¿ã†ãƒ„ãƒ¼ãƒ«ã¯ä¸€éƒ¨ãªã®ã«å…¨ãƒ„ãƒ¼ãƒ«æƒ…å ±ã‚’ä¿æŒ
- MCPã‚µãƒ¼ãƒãƒ¼ãŒå¢—ãˆã‚‹ãŸã³ã«æ¶ˆè²»ãŒå¢—åŠ 

### è§£æ±ºç­–: Search MCP Aggregator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude CLI     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ¥ç¶šå…ˆ:         â”‚
â”‚  - search-mcp   â”‚ â†’ è»½é‡ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
   Search MCP (ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚¿ãƒ¼)
        â†“
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“         â†“          â†“          â†“
filesystem  brave  database   slack
(50 tools) (20)   (30)        (15)

åˆæœŸèª­ã¿è¾¼ã¿: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿ (5,000ãƒˆãƒ¼ã‚¯ãƒ³)
å¿…è¦æ™‚ã®ã¿: å€‹åˆ¥ãƒ„ãƒ¼ãƒ«è©³ç´°ã‚’å–å¾—
```

**åŠ¹æœ**:
- åˆæœŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¶ˆè²»ã‚’ 80% å‰Šæ¸›
- ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãªé–‹ç¤ºã‚’å®Ÿç¾
- MCPã‚µãƒ¼ãƒãƒ¼ã®è¿½åŠ ãŒå®¹æ˜“

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ª

### ãƒšãƒ«ã‚½ãƒŠ: ç”°ä¸­ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢

**ç¾åœ¨ã®è¨­å®š**:
```json
// ~/.config/claude/claude_desktop_config.json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/tanaka/projects"]
    },
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": { "BRAVE_API_KEY": "..." }
    },
    "database": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres"],
      "env": { "DATABASE_URL": "..." }
    },
    "slack": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-slack"],
      "env": { "SLACK_TOKEN": "..." }
    }
  }
}
```

**ã‚„ã‚ŠãŸã„ã“ã¨**:
1. Search MCPã«æ—¢å­˜ã®MCPè¨­å®šã‚’ã‚³ãƒ”ãƒš
2. Claude CLIã®æ¥ç¶šå…ˆã‚’Search MCPã®ã¿ã«å¤‰æ›´
3. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¶ˆè²»ã‚’å‰Šæ¸›ã—ãªãŒã‚‰å…¨æ©Ÿèƒ½ã‚’ä½¿ç”¨

## è¨­è¨ˆ

### 1. MCP Server Registry

#### 1.1 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

**å ´æ‰€**: `~/.search-mcp/servers.json` ã¾ãŸã¯ `./config/mcp-servers.json`

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/Users/tanaka/projects"],
      "enabled": true,
      "metadata": {
        "description": "File system operations",
        "category": "filesystem",
        "tags": ["files", "local"]
      }
    },
    "brave-search": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-brave-search"],
      "env": {
        "BRAVE_API_KEY": "${BRAVE_API_KEY}"
      },
      "enabled": true,
      "metadata": {
        "description": "Web search via Brave",
        "category": "search",
        "tags": ["web", "search"]
      }
    },
    "database": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-postgres"],
      "env": {
        "DATABASE_URL": "${DATABASE_URL}"
      },
      "enabled": true,
      "metadata": {
        "description": "PostgreSQL database operations",
        "category": "database",
        "tags": ["db", "sql"]
      }
    },
    "slack": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-slack"],
      "env": {
        "SLACK_TOKEN": "${SLACK_TOKEN}"
      },
      "enabled": false,
      "metadata": {
        "description": "Slack integration",
        "category": "communication",
        "tags": ["slack", "chat"]
      }
    }
  },
  "settings": {
    "autoStart": true,
    "reconnectOnFailure": true,
    "healthCheckInterval": 60000,
    "timeout": 30000
  }
}
```

**ç‰¹å¾´**:
- âœ… Claude Desktopã®è¨­å®šã¨**ã»ã¼åŒã˜å½¢å¼**ï¼ˆã‚³ãƒ”ãƒšå¯èƒ½ï¼‰
- âœ… ç’°å¢ƒå¤‰æ•°ã®å±•é–‹ã‚’ã‚µãƒãƒ¼ãƒˆ
- âœ… `enabled` ãƒ•ãƒ©ã‚°ã§æœ‰åŠ¹/ç„¡åŠ¹ã‚’åˆ‡ã‚Šæ›¿ãˆ
- âœ… ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã§ã‚«ãƒ†ã‚´ãƒªã‚„ã‚¿ã‚°ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### 1.2 æœ€å°æ§‹æˆ

å¿…é ˆé …ç›®ã®ã¿ã®æœ€å°æ§‹æˆï¼š

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/dir"]
    }
  }
}
```

ã“ã‚Œã ã‘ã§OKï¼

### 2. MCP Client Manager

#### 2.1 å®Ÿè£…è¨­è¨ˆ

```typescript
// src/mcp/mcp-client-manager.ts

import { spawn, ChildProcess } from 'child_process';

export interface MCPServerConfig {
  command: string;
  args?: string[];
  env?: Record<string, string>;
  enabled?: boolean;
  metadata?: {
    description?: string;
    category?: string;
    tags?: string[];
  };
}

export interface MCPServersConfig {
  mcpServers: Record<string, MCPServerConfig>;
  settings?: {
    autoStart?: boolean;
    reconnectOnFailure?: boolean;
    healthCheckInterval?: number;
    timeout?: number;
  };
}

export class MCPClientManager {
  private clients: Map<string, MCPClient>;
  private config: MCPServersConfig;

  constructor(configPath: string) {
    this.clients = new Map();
    this.loadConfig(configPath);
  }

  /**
   * è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
   */
  async loadConfig(configPath: string): Promise<void> {
    const fs = require('fs').promises;
    const content = await fs.readFile(configPath, 'utf-8');

    // ç’°å¢ƒå¤‰æ•°ã‚’å±•é–‹
    const expandedContent = this.expandEnvVars(content);
    this.config = JSON.parse(expandedContent);

    // æœ‰åŠ¹ãªã‚µãƒ¼ãƒãƒ¼ã‚’è‡ªå‹•èµ·å‹•
    if (this.config.settings?.autoStart !== false) {
      await this.startAll();
    }
  }

  /**
   * ç’°å¢ƒå¤‰æ•°ã‚’å±•é–‹
   */
  private expandEnvVars(content: string): string {
    return content.replace(/\$\{([^}]+)\}/g, (match, varName) => {
      return process.env[varName] || match;
    });
  }

  /**
   * ã™ã¹ã¦ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   */
  async startAll(): Promise<void> {
    for (const [name, config] of Object.entries(this.config.mcpServers)) {
      if (config.enabled !== false) {
        await this.start(name);
      }
    }
  }

  /**
   * MCPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   */
  async start(name: string): Promise<void> {
    const config = this.config.mcpServers[name];
    if (!config) {
      throw new Error(`MCP server not found: ${name}`);
    }

    if (this.clients.has(name)) {
      console.log(`MCP server already running: ${name}`);
      return;
    }

    const client = new MCPClient(name, config);
    await client.connect();

    this.clients.set(name, client);
    console.log(`âœ… MCP server started: ${name}`);
  }

  /**
   * MCPã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢
   */
  async stop(name: string): Promise<void> {
    const client = this.clients.get(name);
    if (!client) {
      return;
    }

    await client.disconnect();
    this.clients.delete(name);
    console.log(`â¹ï¸  MCP server stopped: ${name}`);
  }

  /**
   * ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã‚’å–å¾—ï¼ˆè»½é‡ç‰ˆï¼‰
   */
  async listAllTools(): Promise<AggregatedToolMetadata[]> {
    const tools: AggregatedToolMetadata[] = [];

    for (const [serverName, client] of this.clients) {
      const serverTools = await client.listTools();

      for (const tool of serverTools) {
        tools.push({
          ...tool,
          serverName,
          serverCategory: this.config.mcpServers[serverName].metadata?.category,
          serverTags: this.config.mcpServers[serverName].metadata?.tags
        });
      }
    }

    return tools;
  }

  /**
   * ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
   */
  async executeTool(
    serverName: string,
    toolName: string,
    parameters: Record<string, any>
  ): Promise<any> {
    const client = this.clients.get(serverName);
    if (!client) {
      throw new Error(`MCP server not running: ${serverName}`);
    }

    return await client.executeTool(toolName, parameters);
  }

  /**
   * ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
   */
  async healthCheck(): Promise<Record<string, boolean>> {
    const status: Record<string, boolean> = {};

    for (const [name, client] of this.clients) {
      try {
        await client.ping();
        status[name] = true;
      } catch (error) {
        status[name] = false;

        // å†æ¥ç¶šã‚’è©¦ã¿ã‚‹
        if (this.config.settings?.reconnectOnFailure !== false) {
          console.log(`Reconnecting to ${name}...`);
          await this.stop(name);
          await this.start(name);
        }
      }
    }

    return status;
  }

  /**
   * çµ±è¨ˆæƒ…å ±
   */
  getStats(): {
    totalServers: number;
    runningServers: number;
    totalTools: number;
  } {
    return {
      totalServers: Object.keys(this.config.mcpServers).length,
      runningServers: this.clients.size,
      totalTools: Array.from(this.clients.values()).reduce(
        (sum, client) => sum + client.getToolCount(),
        0
      )
    };
  }
}
```

#### 2.2 MCP Clientå®Ÿè£…

```typescript
// src/mcp/mcp-client.ts

export class MCPClient {
  private process: ChildProcess | null = null;
  private connected: boolean = false;
  private tools: ToolMetadata[] = [];

  constructor(
    private name: string,
    private config: MCPServerConfig
  ) {}

  /**
   * MCPã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š
   */
  async connect(): Promise<void> {
    // ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•
    this.process = spawn(this.config.command, this.config.args || [], {
      env: {
        ...process.env,
        ...this.config.env
      },
      stdio: ['pipe', 'pipe', 'pipe']
    });

    // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    this.process.on('error', (error) => {
      console.error(`MCP server error (${this.name}):`, error);
      this.connected = false;
    });

    this.process.on('exit', (code) => {
      console.log(`MCP server exited (${this.name}): ${code}`);
      this.connected = false;
    });

    // MCPåˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
    await this.sendMessage({
      jsonrpc: '2.0',
      id: 1,
      method: 'initialize',
      params: {
        protocolVersion: '1.0.0',
        clientInfo: {
          name: 'search-mcp',
          version: '1.0.0'
        }
      }
    });

    // ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—
    await this.fetchTools();

    this.connected = true;
  }

  /**
   * MCPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰åˆ‡æ–­
   */
  async disconnect(): Promise<void> {
    if (this.process) {
      this.process.kill();
      this.process = null;
    }
    this.connected = false;
  }

  /**
   * ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—
   */
  async listTools(): Promise<ToolMetadata[]> {
    if (this.tools.length === 0) {
      await this.fetchTools();
    }
    return this.tools;
  }

  /**
   * ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ï¼ˆå†…éƒ¨ï¼‰
   */
  private async fetchTools(): Promise<void> {
    const response = await this.sendMessage({
      jsonrpc: '2.0',
      id: 2,
      method: 'tools/list',
      params: {}
    });

    this.tools = response.result.tools || [];
  }

  /**
   * ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
   */
  async executeTool(
    toolName: string,
    parameters: Record<string, any>
  ): Promise<any> {
    const response = await this.sendMessage({
      jsonrpc: '2.0',
      id: Date.now(),
      method: 'tools/call',
      params: {
        name: toolName,
        arguments: parameters
      }
    });

    return response.result;
  }

  /**
   * Pingï¼ˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰
   */
  async ping(): Promise<void> {
    await this.sendMessage({
      jsonrpc: '2.0',
      id: Date.now(),
      method: 'ping',
      params: {}
    });
  }

  /**
   * MCPã‚µãƒ¼ãƒãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
   */
  private async sendMessage(message: any): Promise<any> {
    if (!this.process || !this.connected) {
      throw new Error(`MCP server not connected: ${this.name}`);
    }

    return new Promise((resolve, reject) => {
      const messageStr = JSON.stringify(message) + '\n';

      // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¾…æ©Ÿ
      const timeout = setTimeout(() => {
        reject(new Error('Request timeout'));
      }, 30000);

      const onData = (data: Buffer) => {
        clearTimeout(timeout);
        try {
          const response = JSON.parse(data.toString());
          resolve(response);
        } catch (error) {
          reject(error);
        }
        this.process!.stdout!.off('data', onData);
      };

      this.process.stdout!.on('data', onData);

      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
      this.process.stdin!.write(messageStr);
    });
  }

  /**
   * ãƒ„ãƒ¼ãƒ«æ•°ã‚’å–å¾—
   */
  getToolCount(): number {
    return this.tools.length;
  }
}
```

### 3. APIçµ±åˆ

#### 3.1 ãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—ï¼ˆè»½é‡ç‰ˆï¼‰

```typescript
// src/index.ts

const mcpManager = new MCPClientManager('./config/mcp-servers.json');

// è»½é‡ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‚’è¿”ã™
server.get('/v1/tools', async (request, reply) => {
  const tools = await mcpManager.listAllTools();

  // å¿…è¦æœ€å°é™ã®æƒ…å ±ã ã‘ã‚’è¿”ã™
  return {
    tools: tools.map(tool => ({
      name: `${tool.serverName}.${tool.name}`,  // filesystem.read_file
      description: tool.description,
      server: tool.serverName,
      category: tool.serverCategory,
      // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è©³ç´°ã¯çœç•¥ï¼ˆå¿…è¦æ™‚ã®ã¿å–å¾—ï¼‰
      parametersCount: tool.parameters?.length || 0
    }))
  };
});

// ãƒ„ãƒ¼ãƒ«è©³ç´°å–å¾—
server.get<{ Params: { toolName: string } }>(
  '/v1/tools/:toolName',
  async (request, reply) => {
    const { toolName } = request.params;
    const [serverName, name] = toolName.split('.');

    const client = mcpManager.getClient(serverName);
    const tools = await client.listTools();
    const tool = tools.find(t => t.name === name);

    if (!tool) {
      return reply.code(404).send({ error: 'Tool not found' });
    }

    return {
      ...tool,
      server: serverName
    };
  }
);

// ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
server.post<{
  Body: {
    name: string;
    parameters: Record<string, any>;
  };
}>(
  '/v1/tools/call',
  async (request, reply) => {
    const { name, parameters } = request.body;
    const [serverName, toolName] = name.split('.');

    const result = await mcpManager.executeTool(serverName, toolName, parameters);

    return {
      success: true,
      result
    };
  }
);
```

### 4. è¨­å®šç§»è¡Œãƒ„ãƒ¼ãƒ«

#### 4.1 æ—¢å­˜è¨­å®šã‹ã‚‰ã®å¤‰æ›

```typescript
// src/cli/migrate.ts

export class ConfigMigrator {
  /**
   * Claude Desktopè¨­å®šã‚’å¤‰æ›
   */
  async migrateFromClaudeDesktop(): Promise<void> {
    // Claude Desktopè¨­å®šã‚’èª­ã¿è¾¼ã¿
    const claudeConfigPath = this.getClaudeDesktopConfigPath();
    const claudeConfig = JSON.parse(
      await fs.readFile(claudeConfigPath, 'utf-8')
    );

    // Search MCPå½¢å¼ã«å¤‰æ›ï¼ˆã»ã¼ãã®ã¾ã¾ä½¿ãˆã‚‹ï¼‰
    const searchMcpConfig: MCPServersConfig = {
      mcpServers: claudeConfig.mcpServers || {},
      settings: {
        autoStart: true,
        reconnectOnFailure: true
      }
    };

    // Search MCPè¨­å®šã‚’ä¿å­˜
    const searchMcpConfigPath = './config/mcp-servers.json';
    await fs.writeFile(
      searchMcpConfigPath,
      JSON.stringify(searchMcpConfig, null, 2)
    );

    console.log('âœ… Migration completed!');
    console.log(`Config saved to: ${searchMcpConfigPath}`);
  }
}
```

```bash
# ç§»è¡Œã‚³ãƒãƒ³ãƒ‰
search-mcp migrate --from claude-desktop

# å‡ºåŠ›ä¾‹
âœ… Found 4 MCP servers in Claude Desktop config
âœ… Migration completed!
ğŸ“ Config saved to: ./config/mcp-servers.json

Next steps:
1. Review the config file
2. Update Claude Desktop config to use search-mcp only
```

### 5. Claude CLIè¨­å®šã®æ›´æ–°

ç§»è¡Œå¾Œã€Claude Desktopã®è¨­å®šã‚’æ›´æ–°ï¼š

**å¤‰æ›´å‰**:
```json
{
  "mcpServers": {
    "filesystem": { ... },
    "brave-search": { ... },
    "database": { ... },
    "slack": { ... }
  }
}
```

**å¤‰æ›´å¾Œ**:
```json
{
  "mcpServers": {
    "search-mcp": {
      "command": "node",
      "args": ["/path/to/search-mcp/dist/index.js"]
    }
  }
}
```

ãŸã£ãŸ1ã¤ã®ã‚¨ãƒ³ãƒˆãƒªã ã‘ï¼

### 6. ä½¿ç”¨ãƒ•ãƒ­ãƒ¼

#### 6.1 åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# Step 1: Search MCPã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g search-mcp

# Step 2: æ—¢å­˜è¨­å®šã‚’ç§»è¡Œ
search-mcp migrate --from claude-desktop

# Step 3: Search MCPã‚’èµ·å‹•
search-mcp start

# Step 4: Claude Desktopè¨­å®šã‚’æ›´æ–°
search-mcp setup --replace-all

# Step 5: Claude Desktopã‚’å†èµ·å‹•
```

#### 6.2 æ–°ã—ã„MCPã‚µãƒ¼ãƒãƒ¼ã‚’è¿½åŠ 

```bash
# æ–¹æ³•A: æ‰‹å‹•ã§ç·¨é›†
vi ~/.search-mcp/servers.json

# æ–¹æ³•B: CLIã§è¿½åŠ 
search-mcp mcp add github \
  --command npx \
  --args "-y,@modelcontextprotocol/server-github" \
  --env "GITHUB_TOKEN=${GITHUB_TOKEN}"

# ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œäºˆå®šï¼‰
search-mcp restart
```

### 7. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‰Šæ¸›ã®å®Ÿæ¸¬

#### 7.1 å‰Šæ¸›åŠ¹æœ

**å¾“æ¥**ï¼ˆ4ã¤ã®MCPã‚µãƒ¼ãƒãƒ¼ã‚’ç›´æ¥æ¥ç¶šï¼‰:
```
åˆæœŸèª­ã¿è¾¼ã¿:
- filesystem: 50 tools Ã— 200 tokens = 10,000 tokens
- brave-search: 20 tools Ã— 200 tokens = 4,000 tokens
- database: 30 tools Ã— 200 tokens = 6,000 tokens
- slack: 15 tools Ã— 200 tokens = 3,000 tokens
åˆè¨ˆ: 23,000 tokens
```

**Search MCPçµŒç”±**:
```
åˆæœŸèª­ã¿è¾¼ã¿ï¼ˆè»½é‡ç‰ˆï¼‰:
- ãƒ„ãƒ¼ãƒ«åã¨ã‚µãƒ¼ãƒãƒ¼åã®ã¿
- 115 tools Ã— 50 tokens = 5,750 tokens

è©³ç´°èª­ã¿è¾¼ã¿ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰:
- ä½¿ç”¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã®ã¿ãƒ•ã‚§ãƒƒãƒ
- ä¾‹: 3 tools Ã— 200 tokens = 600 tokens

åˆè¨ˆ: 6,350 tokens (72% å‰Šæ¸›ï¼)
```

#### 7.2 æ®µéšçš„ãªæƒ…å ±å–å¾—

```
1. åˆæœŸ: GET /v1/tools
   â†’ è»½é‡ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§ï¼ˆåå‰ã€èª¬æ˜ã€ã‚µãƒ¼ãƒãƒ¼åã®ã¿ï¼‰

2. ãƒ„ãƒ¼ãƒ«é¸æŠå¾Œ: GET /v1/tools/{toolName}
   â†’ è©³ç´°ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æƒ…å ±

3. å®Ÿè¡Œ: POST /v1/tools/call
   â†’ ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ
```

### 8. å®Ÿè£…å„ªå…ˆé †ä½

#### Phase 1: åŸºæœ¬ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- [ ] MCPServerConfigå‹å®šç¾©
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
- [ ] MCPClientManagerã®å®Ÿè£…
- [ ] MCPClientã®å®Ÿè£…ï¼ˆstdioé€šä¿¡ï¼‰
- [ ] åŸºæœ¬çš„ãªãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—

#### Phase 2: ç®¡ç†æ©Ÿèƒ½
- [ ] ç§»è¡Œãƒ„ãƒ¼ãƒ«ï¼ˆmigrate ã‚³ãƒãƒ³ãƒ‰ï¼‰
- [ ] MCPã‚µãƒ¼ãƒãƒ¼ã®è¿½åŠ /å‰Šé™¤CLI
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- [ ] è‡ªå‹•å†æ¥ç¶š

#### Phase 3: æœ€é©åŒ–
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- [ ] ä¸¦åˆ—ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
- [ ] ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰

## ã¾ã¨ã‚

**Search MCP Aggregatorã®ç‰¹å¾´**:

1. âœ… **æ—¢å­˜è¨­å®šã‚’ã»ã¼ãã®ã¾ã¾ä½¿ç”¨å¯èƒ½**
   - Claude Desktopã® `mcpServers` ã‚’ã‚³ãƒ”ãƒšã™ã‚‹ã ã‘

2. âœ… **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¶ˆè²»ã‚’å¤§å¹…å‰Šæ¸›**
   - 70-80% ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‰Šæ¸›
   - æ®µéšçš„ãªæƒ…å ±å–å¾—

3. âœ… **ç°¡å˜ãªç§»è¡Œ**
   - `search-mcp migrate` ã§æ—¢å­˜è¨­å®šã‚’å¤‰æ›
   - CLIã¯ Search MCP 1ã¤ã ã‘æ¥ç¶šã™ã‚Œã°OK

4. âœ… **ç®¡ç†ãŒå®¹æ˜“**
   - 1ã¤ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å…¨MCPã‚’ç®¡ç†
   - æœ‰åŠ¹/ç„¡åŠ¹ã®åˆ‡ã‚Šæ›¿ãˆãŒç°¡å˜

ã“ã‚Œã§æ­£ã—ã„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«åˆã£ãŸè¨­è¨ˆã«ãªã‚Šã¾ã—ãŸï¼
